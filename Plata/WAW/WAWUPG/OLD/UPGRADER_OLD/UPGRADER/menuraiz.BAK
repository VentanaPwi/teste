* MENURAIZ.PRG - MENU (PROGRAMA PRINCIPAL DO SISTEMA)
*************
PARAMETERS tcPARAMEXE

SET TALK OFF
SET ESCAPE OFF
SET EXCL OFF
SET DELE ON
SET DATE BRITISH
SET CURSOR ON
SET NOTIFY OFF
SET SAFETY OFF
SET READBORDER ON
SET DECIMAL TO 8
SET REPROCESS TO 3 SECONDS
SET POINT TO ','
SET SEPA TO '.'
SET EXACT OFF
SET NEAR OFF
SET CONFIRM ON
SET CLOCK STATUS
SET CENTURY ON
SET MEMOWIDTH TO 512
SET HOURS TO 24
SET ENGINEBEHAVIOR 80
SET REPORTBEHAVIOR 90

IF TYPE('tcPARAMEXE')<>'C'
	tcPARAMEXE = ''
ENDIF
tcPARAMEXE = ALLTRIM(UPPER(tcPARAMEXE))+' '

_SCREEN.WINDOWSTATE	= 2		&& tela cheia
_SCREEN.VISIBLE	= .T.		&& tela cheia
_SCREEN.MAXBUTTON	= .F.

IF EMPTY(tcPARAMEXE)
	CLEAR ALL
	PRIVATE tcPARAMEXE AS STRING
	tcPARAMEXE = ''
ENDIF
CLEAR PROGRAM
CLOSE ALL

LOCAL lcARQUIVO, lcARQUIVO2 AS String

* VERIFICA SE É PASTA DE SISTEMA
lcARQUIVO	= '..\SISTEMA.PWI'
lcARQUIVO2	= '..\CONFIG.PWI'
IF NOT FILE(lcARQUIVO)
	IF NOT FILE(lcARQUIVO2)
		DO MENS WITH 'NÃO É PASTA DE SISTEMA!'
	ENDIF
ENDIF
* ARQUIVO CONFIGURADOR DE PASTAS
lcARQUIVO	= 'UPGRADER.PWI'
IF NOT FILE(lcARQUIVO)
	DO MENS WITH 'ARQUIVO CONFIGURADOR DE EXTENSÕES AUSENTE! ('+lcARQUIVO+')'
	RETURN
ENDIF
TRY 
	USE &lcARQUIVO IN 0 ALIAS UPGRADER
CATCH
FINALLY
ENDTRY
IF NOT USED('UPGRADER')
	DO MENS WITH 'PROBLEMAS AO ABRIR ARQUIVO CONFIGURADOR DE EXTENSÕES! ('+lcARQUIVO+')'
	RETURN
ENDIF

* TRATAMENTO DE ERROS
IF '\TESTES' $ CURDIR()
	ON KEY LABEL CTRL+F2 ACTIVATE WINDOW COMMAND
	SET STATUS BAR ON
ELSE
	SET RESOURCE OFF
	ON ERROR DO ROTERRO WITH ERROR(),MESSAGE(),PROGRAM(),LINENO()
	ON SHUTDOWN QUIT
	SET STATUS BAR OFF
ENDIF

IF 'GERAR' $ tcPARAMEXE
	DO FORM GERAR
ELSE
	DO FORM PRINCIPAL
ENDIF

CLEAR ALL
RETURN

PROC STARTAFILE
***************
LPARAMETERS tcARQUIVO AS String
	IF TYPE('tcARQUIVO') <> 'C'
		tcARQUIVO = ''	
	ENDIF
	IF EMPTY(tcARQUIVO)
		RETURN
	ENDIF
	IF NOT FILE(tcARQUIVO)
		DO MENS WITH 'ARQUIVO NÃO ENCONTRADO: '+tcARQUIVO
		RETURN
	ENDIF

	DECLARE LONG ShellExecute IN "shell32.dll" ;
		LONG HWND, STRING lpszOp, ;
		STRING lpszFile, STRING lpszParams, ;
		STRING lpszDir, LONG nShowCmd

	SHELLEXECUTE( 0, 'Open', FULLPATH(tcARQUIVO), 0, 0, 1)

RETURN

PROC ESPERANDO
**************
LPARAMETER tcMESS AS String
	WAIT WINDOW tcMESS NOWAIT NOCLEAR
RETURN

PROC MENS
*********
PARAMETERS tcMENSAGEM,tnERRO
* MENSAGEM AO USUARIO, SE TNERRO=1 A MENSAGEM É MAIS GRAVE.
	IF TYPE('tnERRO')<>'N'
		tnERRO = 0
	ENDIF
	tnERRO = IIF(tnERRO>0,48,64)
	=MESSAGEBOX(tcMENSAGEM,'AVISO',48)
RETURN

PROC SIMOUNAO
*************
PARAMETERS tcPERGUNTA, tcTITULO, tnDEFAULT
	LOCAL lnBOTAO AS Number
	IF tnDEFAULT=1
		tnBOTAO = 0
	ELSE
		tnBOTAO = 256
	ENDIF
	IF MESSAGEBOX( tcPERGUNTA, tcTITULO, 32+4+tnBOTAO )=6
		RETURN(.T.)
	ENDIF
RETURN(.F.)

FUNC TIRANONUM
**************		PEGA APENAS OS NUMEROS DE UMA STRING
LPARAMETERS lcCAMPO
LOCAL lcSONUM AS String
LOCAL lnI AS INTEGER
lcSONUM = ''
FOR lnI = 1 TO LEN(lcCAMPO)
	lcALGA = SUBS(lcCAMPO,lnI,1)
	IF lcALGA $ '0987654321'
		lcSONUM = lcSONUM + lcALGA
	ENDIF
ENDFOR
RETURN(lcSONUM)

FUNC TEMPFILE
*************
	LOCAL lcCPOOUT, lcTEMP AS String
	LOCAL lnI AS Number
	lcTEMP	 = GETENV("TEMP")+'\'
	FOR lnI = 1 TO 100
		lcCPOOUT = lcTEMP+SYS(3)+'.TMP'
		IF NOT FILE(lcCPOOUT)
			EXIT
		ENDIF
	ENDFOR
RETURN(lcCPOOUT)

FUNC STRZERO
************
LPARAMETERS tnVALOR,tnTAM
	LOCAL lcOUT AS STRING
	lcOUT = STR(tnVALOR,tnTAM)
	lcOUT = STRTRAN(lcOUT," ","0")
RETU(lcOUT)

FUNC FNOMDIA
************
LPARAMETERS tdDAY
	IF VARTYPE(tdDAY)='T'
		tdDAY = TTOD(tdDAY)
	ENDIF
	tdDAY1 = IIF(TYPE('tdDAY')='D',DOW(tdDAY),tdDAY)
	LOCAL tnDAY1 AS INTEGER
	tnDAY1 = IIF(TYPE('tdDAY')='D',DOW(tdDAY),tdDAY)
RETURN SUBS('DomingoSegundaTerça  Quarta Quinta Sexta  Sábado ',(tnDAY1-1)*7+1,7)

FUNC FNOMMES
************
LPARAMETERS tdMES
	IF TYPE('tdMES') = 'T'
		tdMES = TTOD(tdMES)
	ENDIF
	IF NOT TYPE('tdMES') $ 'DN'
		tdMES = DATE()
	ENDIF
	LOCAL lnMES AS Integer
	IF TYPE('tdMES') = 'D'
		lnMES = MONTH(tdMES)
	ELSE
		IF tdMES > 12 OR tdMES < 1
			tdMES = MONTH(DATE())
		ENDIF
		lnMES = tdMES
	ENDIF
	lcMES = SUBS('Janeiro  FevereiroMarço    Abril    Maio     Junho    Julho    Agosto   Setembro Outubro  Novembro Dezembro ',(lnMES-1)*9+1, 9)
RETURN(lcMES) 

PROC ROTERRO
************
PARAMETERS tnMYERRO, tcMYMESS, tcMYPROG, tnMYLINH
	DO CASE
	CASE tnMYERRO = 1705
		DO MENS WITH 'ACESSO NÃO PERMITIDO NO MOMENTO! '+CHR(13)+CHR(13)+;
		'Um Arquivo está bloqueado pela rede, por um processo ou por outro usuário.'
	OTHERWISE
		=MESSAGEBOX('Ocorreu uma falha no seu aplicativo e ele terá que ser encerrado! Anote a mensagem de erro e entre em contato com o suporte técnico do seu software. ERRO: '+;
		ALLTRIM(STR(tnMYERRO)) + '=' + tcMYMESS + ' LINHA ' + ALLTRIM(STR(tnMYLINH)) + ':' + tcMYPROG, 'ERRO',48)
		IF TYPE('_SCREEN.ACTIVEFORM')='O'
			_SCREEN.ActiveForm.release()
		ELSE
			CANCEL
		ENDIF
	ENDCASE
RETURN

