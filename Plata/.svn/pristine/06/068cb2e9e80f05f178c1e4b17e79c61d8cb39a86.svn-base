USE MASTER; 
GO
CREATE PROCEDURE SP_FIXSEEDS2012
AS
BEGIN

    --FOREACH DATABASE
    DECLARE @DATABASENAME VARCHAR(255)
    
    DECLARE DATABASESCURSOR CURSOR READ_ONLY
    FOR
        SELECT NAME
        FROM SYS.DATABASES
        WHERE NAME NOT IN ('MASTER','TEMPDB','MODEL','MSDB') AND SYS.DATABASES.STATE_DESC = 'ONLINE'

    OPEN DATABASESCURSOR

    FETCH NEXT FROM DATABASESCURSOR
    INTO @DATABASENAME

    WHILE @@FETCH_STATUS = 0
    BEGIN
    
        EXEC ('USE '+@DATABASENAME + '

        --FOREACH IDENTITY COLUMN
        DECLARE @TABLENAME VARCHAR(255)
        DECLARE @COLUMNNAME VARCHAR(255)
        DECLARE @SCHEMANAME VARCHAR(255)
    
        DECLARE IDENTITYCOLUMNCURSOR CURSOR READ_ONLY
        FOR
        
            SELECT TABLE_NAME , COLUMN_NAME, TABLE_SCHEMA 
            FROM INFORMATION_SCHEMA.COLUMNS 
            WHERE COLUMNPROPERTY(OBJECT_ID(TABLE_NAME), COLUMN_NAME, ''ISIDENTITY'') = 1 
        

        OPEN IDENTITYCOLUMNCURSOR

        FETCH NEXT FROM IDENTITYCOLUMNCURSOR
        INTO @TABLENAME, @COLUMNNAME, @SCHEMANAME

        WHILE @@FETCH_STATUS = 0
        BEGIN
        
            PRINT ''['+@DATABASENAME+'].[''+@TABLENAME+''].[''+@SCHEMANAME+''].[''+@COLUMNNAME+'']'' 
            EXEC (''DECLARE @MAX INT = 1
                    SELECT @MAX = MAX(''+@COLUMNNAME+'') FROM ['+@DATABASENAME+'].[''+@SCHEMANAME+''].[''+@TABLENAME+'']
                    IF (@MAX IS NULL)
                    BEGIN
                        SET @MAX = 1
                    END
                    DBCC CHECKIDENT(['+@DATABASENAME+'.''+@SCHEMANAME+''.''+@TABLENAME+''],RESEED,@MAX)'')

            FETCH NEXT FROM IDENTITYCOLUMNCURSOR
            INTO @TABLENAME, @COLUMNNAME, @SCHEMANAME

        END

        CLOSE IDENTITYCOLUMNCURSOR
        DEALLOCATE IDENTITYCOLUMNCURSOR')



        FETCH NEXT FROM DATABASESCURSOR
        INTO @DATABASENAME

    END

    CLOSE DATABASESCURSOR
    DEALLOCATE DATABASESCURSOR
END
GO

EXEC SP_CONFIGURE 'SHOW ADVANCED OPTIONS', 1 ;
GO
RECONFIGURE
GO
EXEC SP_CONFIGURE 'SCAN FOR STARTUP PROCS', 1 ;
GO
RECONFIGURE
GO

EXEC SP_PROCOPTION @PROCNAME = 'SP_FIXSEEDS2012' 
    , @OPTIONNAME = 'STARTUP' 
    , @OPTIONVALUE = 'TRUE' 
GO